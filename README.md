# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара
```
export interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```
Данные пользователя/покупателя
```
export interface IUser {
    payment: string;
    address: string;
    email: string;
    phone: string;
}
```
Форма оплаты и адреса
```
export type TOrder =  Pick<IUser, 'payment' | 'address'>;
```
Форма контактных данных пользователя
```
export type TBuyerInfo =  Pick<IUser, 'email' | 'phone'>;
```
Форма корзины
```
export type TBasket = Pick<IProduct, 'title' | 'price'>;
```
Форма успешной оплаты
```
export interface ISuccessfulOrder {
    id: string;
    total: number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, который отвечает за отображение данных на странице 
- слой данных, который отвечает за хранение и изменение данных
- презентер, который отвечает за связь представления и данных

### Базовый код

#### Класс Api

```
export class Api {
    readonly baseUrl: string;
    protected options: RequestInit;

    constructor(baseUrl: string, options: RequestInit = {}) {
        this.baseUrl = baseUrl;
        this.options = {
            headers: {
                'Content-Type': 'application/json',
                ...(options.headers as object ?? {})
            }
        };
    }
}
```
Содержит в себе базовую логику отправки запросов.

Конструктор:
- `constructor()` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля:
- `baseUrl`: string - базовый адрес сервера
- `options`: RequestInit - объект с заголовками запросов

Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает дромис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоину переданных как параметр при вызове метода. По умолчанию выполняется "POST" запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове
- `handleResponse()`- выполняет проверку ответов от сервера.

#### Класс EventEmitter
```
export class EventEmitter implements IEvents {
    _events: Map<EventName, Set<Subscriber>>;

    constructor() {
        this._events = new Map<EventName, Set<Subscriber>>();
    }
}
```
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. 

Конструктор:
- `constructor()` - выполняет инициализацию объекта, создавая пустую структуру данных для хранения событий

Поля: 
- `events` - используется для хранения информации о событиях и их подписчиках

Методы:
- `on` - установка обработчика на событие
- `off` - снятие обработчика с события
- `emit` - инициализация события с данными
- `trigger` - выполнение коллбек триггера, генерирующего событие при вызове
- `onAll` - слушатель на все события
- `offAll` - сброс всех обработчиков с события

### Слой данных

#### Класс ProductCardData
Класс отвечает за хранение и логику работы с данными карточки продукта.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `_items: IProduct[]` - хранит массив объектов карточек
- `_preview: string | null` - id карточки выбранной для просмотра в модальном окне
- `events:IEvents` - экземпрляр класса `EventEmitter` для инициации событий при изменении данных.

Методы:
- `addCardProduct(card:IProduct):void`- выполняет добавление карточки продукта в массив
- `deleteCardProduct(cardId: string, payload: Function | null): void` - выполяет удаление карточки массива
- `updateCardProduct(card: IProduct, payload: Function | null): void` - обновляет данные карточки в массиве
- `getCardProduct(cardId: string): IProduct` - возвращение карточки по её id
- `checkProductValidation(data: Record<keyof IProduct, string>): boolean` - проверяет объект с данными карточки товара на валидность
-  сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс UserData
Класс отвечает за хранение и логику работы с данными теущего пользователя.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `userPayment: string` - способ оплаты
- `userAddress: string`- адресс проживания пользователя
- `userEmail: string`- почтовый адресс пользователя
- `userPhone: string`- номер телефона пользователя
- `events:IEvents` - экземпрляр класса `EventEmitter` для инициации событий при изменении данных.

Методы:
- `getUserInfo(): IUser`- возвращает основные данные пользователя отображаемые на сайте
- `setUserInfo(userData:IUser): void`- сохраняет данные пользовател в классе
- `checkUserValidation(data: Record<keyof IUser, string>): boolean` - проверяе объект с данными на пользователя на валидность

### Слой отображения
Все классы представления отвечают за отображение внутри контейнера (DOM-элемента) передаваемых в них данных

#### Класс Modal
Реализует модальное окно. Устанавливает слушатели на клавиатуру для закрытия модального окна по ESC, клику на оверлей или кнопку-крестик. 
Конструктор: 
- `constructor(container: HTMLElement, events: IEvents)` 

Поля класса:
- `container: HTMLElement` - переключатель модального окна
- `events: IEvents` - брокер событий
- `content: HTMLElement` - контент, находящийся в модальном окне
- `closeButton: HTMLButtonElement`- кнопка закрытия модального окна

Методы класса: 
- `open()` - управляет отображением модального окна - показывает на странице
- `close()` - управляет отображением модального окна - скрывает со страницы
- `setContent()` - присваивает контен модальному окну


#### Класс Basket
Расширяет класс Modal. Предназначен для реализации модального окна с формой, содержащей информацию о выбранных для оформления заказа товаров. При сабмите инициирует событие подтверждения данных и переходу к оформлению заказа.

Конструктор: 
- `constructor(container: HTMLElement, events: IEvents)` -  наследуется от абстрактного класса Modal

Поля класса:
- `orderButton: HTMLButtonElement` - кнопка подтверждения
- `list: HTMLElement[]` - коллекция всех выбранных товаров
- `total: string` - сумма для оплаты

Методы: 
- `getList()` - получение списка выбранных товаров
- `setList()` - вывод списка выбранных товаров
- `setTotal()` - вывод общей стоимости товаров

#### Класс ModalToOrder
Расширяет класс Modal. Реализует модальное окно для ввода данных для оформления заказа.

Конструктор: 
- `constructor(container: HTMLElement, events: IEvents)` 

Поля класса:
- `submitButton: HTMLButtonElement` - кнопка подтверждения
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов
- `inputs: NodeListOf<HTMLInputElement>` - коллекции всех полей ввода формы

Методы: 
- `setError()` - принимает объект с данными для отображения или скрытия ошибок под полями ввода
- `showInputError()`- отображает полученный текст ошибки под указанным полем ввода
- `hideInputError()` - скрывает текст ошибки под указанным полем ввода
- `clearModal()` - очищает поля формы и сбрасывает состояния кнопок при сабмите


#### Класс OrderForm
Предназначен для реализации модального окна с формой, содержащей поле ввода адреса и способов оплаты заказа. При сабмите инициирует событие подтверждения данных для отправки и оплаты заказа. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. Наследуется от класса ModalToOrder
Конструктор: 
- `constructor(container: HTMLElement, events: IEvents)` - конструктор наследуется от абстрактного класса ModalForOrder
Поля класса:
- `PaymentButton: HTMLButtonElement` - кнопка выбора способа оплаты
- `address: HTMLInputElement` - элемент формы для ввода адреса

Методы: 
- `setAddress()` - устанавливает значение в поле адреса
- `setPayment()` - переключает выбранную пользователем кнопку выбора способа оплаты


#### Класс ContactsForm
Предназначен для реализации модального окна с формой, содержащей поля ввода телефона и эмейла. При сабмите инициирует событие подтверждения данных и переход на окно с уведомлением об успешном оформлении заказа. Наследуется от класса Наследуется от класса ModalToOrder
Конструктор: 
- `constructor(container: HTMLElement, events: IEvents)` 
Поля класса:
- `email: HTMLInputElement` - поле ввода для почтового адресса пользователя
- `phone: HTMLInputElement` - поле ввода номера телефона пользователя

Методы: 
- `setEmail()` - устанавливает значение в поле почтового адреса 
- `setPhone()` - устанавливает значение в поле контактного телефона 

#### Класс ModalSuccessOrder
Наследуется от класса Modal. Предназначен для реализации модального окна с формой, содержащей сообщение об успешном оформлении заказа, в которое передаётся полная стоимость корзины. 

Конструктор: 
- `constructor(container: HTMLElement, events: IEvents)`
Поля класса:
- `closeButton: HTMLButtonElement` - кнопка закрытия формы при успешном оформлении заказа
- `total: number` - общая сумма покупки
- `description: HTMLElement` - сообщение об успешном оформлении заказа

Методы: 
- `setTotal()` - устанавливает значение в поле общей суммы заказа

#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные названия товара, изображения, категории товара, описания товара, цены товара. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с
которыми пользователя генерируются соответствующие события.

Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр 'EventEmitter" для инициации событий. \

Методы:
- `setData(cardData: ICard, userid: string): void` - заполняет атрибуты элементов карточки данными. 
- `selected(: boolean)` - метод определяет была ли выбрана карточка товара для добавления в корзиру или нет
- `render(): HTMLElement` - метод возвращает полностью заполненную карточку с установленными слушателями
- геттер id возвращает уникальный id карточки

#### Класс ProductCardList 
Наследуется от класса Api. Используется для вывода карточек товаров на странице, а также отправки заказа
Конструктор: 
- `constructor(cdn: string, baseUrl: string, options: RequestInit = {})`
Поля класса:
- `cdn: string` - используется для формирования полного пути к изображениям продуктов

Методы: 
- `getProductItem(id: string): Promise<IProduct>` - получает данные о продукте по его ID и добавить полный URL изображения
- `getProductList(): Promise<IProduct[]>` - получает список продуктов и добавить полный URL изображения для каждого продукта


### Слой коммуникации

#### Класс AppApi
Принимает в коструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и их обработчиков. 

Список событий, которые могут генерироваться в системе

- `items:changed` - изменение массива карточек товаров.
- `card:select` - при клике на товар всплывает модальное окно с подробной информацией о товаре и возможностью добавления товара в корзину.
- `card:add` - при клике в модальном окне товара на кнопку "добавить в корзину" происходит добавление товара.
- `card:remove` - при клике на кнопку удаления товара в корзине.
- `basket:open`- открытие модального окна с содержимым корзины.
- `basket:changed` - изменение содержимого корзины и оформление заказа из корзины.
- `order:submit` - подтверждение данных для оплаты и доставки.
- `contacts:submit` - подтверждение контактных данных.
- `order:complete` - при открытии окна успешной оплаты.
- `formErrors:change` - событие, сообщающее о необходимости валидации форм с вводом адреса и способа оплаты и с контактными данными. 
- `/^(order|contacts)\..*:change/` - регулярное выражениедля всех изменений полей заказа.
- `success:finish` - окно успешного оформления заказа.
- `modal:open` - открытие модального окна.
- `modal:close` - закрытие модального окна.